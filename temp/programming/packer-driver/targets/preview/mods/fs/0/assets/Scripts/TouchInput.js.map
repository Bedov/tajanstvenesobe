{"version":3,"sources":["file:///Users/aleksandarbedov/Documents/CocosCreator/tajanstvenesobe2/assets/Scripts/TouchInput.ts"],"names":["_decorator","Component","Node","Vec2","SystemEvent","Vec3","UITransform","find","FirstPersonCameraMovementTest","DetectTypeOfDevice","DetectTypeOfDeviceElevator","FirstPersonCameraMovementElevator","ccclass","property","TouchInput","Boolean","update","vec3ForMovement","Joystick_Ball","position","multiplyScalar","Joystick_Max","_firstPersonCameraMovement","creatingFinalVectorTouch","start","Player","node","on","EventType","TOUCH_START","Joystick_Touch_Start","TOUCH_MOVE","Joystick_Touch_Move","TOUCH_END","Joystick_Touch_End","TOUCH_CANCEL","elevatorScript","getComponent","_JoystickSize","width","onDestroy","off","event","_keyPresed","touch_pos","getUIStartLocation","x","y","local_touch_pos","convertToNodeSpaceAR","Limit_joystick_Vector","Set_Joystick_Ball_Position","Joystick_Vector","detectType","joystick_Mouse_Move","getUILocation","ZERO","pos","setPosition","joystick_vector","input_mag","length"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Vec2, SystemEvent, Vec3, UITransform, Touch, Canvas, game, Game, find } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * Predefined variables\r\n * Name = TouchInput\r\n * DateTime = Mon Nov 15 2021 18:58:12 GMT+0100 (Central European Standard Time)\r\n * Author = stickandrope\r\n * FileBasename = TouchInput.ts\r\n * FileBasenameNoExtension = TouchInput\r\n * URL = db://assets/Scripts/TouchInput.ts\r\n * ManualUrl = https://docs.cocos.com/creator/3.3/manual/en/\r\n *\r\n */\r\n import { FirstPersonCameraMovementTest } from \"./FirstPersonCameraMovementTest\"; \r\n import { DetectTypeOfDevice } from \"./DetectTypeOfDevice\"; \r\nimport { DetectTypeOfDeviceElevator } from './DetectTypeOfDeviceElevator';\r\nimport { FirstPersonCameraMovementElevator } from './FirstPersonCameraMovementElevator';\r\n\r\n\r\n@ccclass('TouchInput')\r\nexport class TouchInput extends Component {\r\n\r\n    Player?: Node;\r\n\r\n    @property(Node)\r\n    Joystick_Ball!: Node;\r\n\r\n    @property(Vec3)\r\n    Joystick_Vector!: Vec3;\r\n\r\n    @property\r\n    Joystick_Max = 1;\r\n\r\n    @property(Boolean)\r\n    elevatorScript = false;\r\n\r\n    _JoystickSize = 0;\r\n    _firstPersonCameraMovement!: FirstPersonCameraMovementTest;\r\n\r\n    update() {\r\n\r\n        let vec3ForMovement = new Vec3(this.Joystick_Ball.position);//new Vec3( this.Joystick_Ball.position.);\r\n        vec3ForMovement.multiplyScalar(1 / this.Joystick_Max);\r\n        this._firstPersonCameraMovement.creatingFinalVectorTouch( vec3ForMovement );\r\n        \r\n        \r\n        //this.Joystick_Ball.position.x\r\n    }\r\n\r\n    start () {\r\n        this.Player = find(\"Player\")!;\r\n\r\n        this.node.on(SystemEvent.EventType.TOUCH_START, this.Joystick_Touch_Start, this);\r\n        this.node.on(SystemEvent.EventType.TOUCH_MOVE, this.Joystick_Touch_Move, this);\r\n        this.node.on(SystemEvent.EventType.TOUCH_END, this.Joystick_Touch_End, this);\r\n        this.node.on(SystemEvent.EventType.TOUCH_CANCEL, this.Joystick_Touch_End, this);\r\n\r\n        if(this.elevatorScript)\r\n            this._firstPersonCameraMovement = this.Player!.getComponent(FirstPersonCameraMovementElevator)!;\r\n        else\r\n            this._firstPersonCameraMovement = this.Player!.getComponent(FirstPersonCameraMovementTest)!;\r\n\r\n\r\n        if(this.getComponent(UITransform) != null)\r\n            this._JoystickSize = this.getComponent(UITransform)!.width;\r\n    }\r\n\r\n\r\n    onDestroy() {\r\n        this.node.off(SystemEvent.EventType.TOUCH_START, this.Joystick_Touch_Start, this);\r\n        this.node.off(SystemEvent.EventType.TOUCH_MOVE, this.Joystick_Touch_Move, this);\r\n        this.node.off(SystemEvent.EventType.TOUCH_END, this.Joystick_Touch_End, this);\r\n        this.node.off(SystemEvent.EventType.TOUCH_CANCEL, this.Joystick_Touch_End, this);\r\n    }\r\n\r\n    Joystick_Touch_Start(event: Touch){\r\n        this._firstPersonCameraMovement._keyPresed = true;\r\n\r\n        let touch_pos = new Vec3 (event.getUIStartLocation().x, event.getUIStartLocation().y, 0) ; \r\n        \r\n        let local_touch_pos = this.node.getComponent(UITransform)!.convertToNodeSpaceAR(touch_pos) ;   \r\n\r\n        this.Limit_joystick_Vector(local_touch_pos);\r\n        this.Set_Joystick_Ball_Position(local_touch_pos);\r\n        this.Joystick_Vector = local_touch_pos;\r\n\r\n    }\r\n\r\n    Joystick_Touch_Move(event: Touch){\r\n        if(this.elevatorScript)\r\n            var detectType = find(\"Canvas\")!.getComponent(DetectTypeOfDeviceElevator) ;\r\n        else\r\n            var detectType = find(\"Canvas\")!.getComponent(DetectTypeOfDevice);\r\n\r\n        detectType!.joystick_Mouse_Move();\r\n\r\n        \r\n        //Treba mozda pokriti dva prsta\r\n        let touch_pos = new Vec3 (event.getUILocation().x, event.getUILocation().y, 0) ; \r\n\r\n        let local_touch_pos = this.node.getComponent(UITransform)!.convertToNodeSpaceAR(touch_pos) ;   \r\n        this.Limit_joystick_Vector(local_touch_pos);\r\n        this.Set_Joystick_Ball_Position(local_touch_pos);\r\n        this.Joystick_Vector = local_touch_pos;\r\n\r\n\r\n\r\n    }\r\n\r\n    Joystick_Touch_End(){\r\n        this._firstPersonCameraMovement._keyPresed = false;\r\n\r\n        this.Joystick_Vector = new Vec3(Vec2.ZERO.x, Vec2.ZERO.y, 0);\r\n        this.Set_Joystick_Ball_Position( new Vec3(Vec2.ZERO.x, Vec2.ZERO.y, 0) );\r\n    }\r\n\r\n    Set_Joystick_Ball_Position(pos: Vec3){\r\n        \r\n        //console.log(\"SetJoystick \" + pos);\r\n        \r\n        this.Joystick_Ball.setPosition(pos);\r\n    }\r\n\r\n    Limit_joystick_Vector(joystick_vector: Vec3){\r\n\r\n        let input_mag = joystick_vector.length();\r\n        if(input_mag > this.Joystick_Max){\r\n            joystick_vector.multiplyScalar(this.Joystick_Max/input_mag);//  mulSelf();\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * [1] Class member could be defined like this.\r\n * [2] Use `property` decorator if your want the member to be serializable.\r\n * [3] Your initialization goes here.\r\n * [4] Your update function goes here.\r\n *\r\n * Learn more about scripting: https://docs.cocos.com/creator/3.3/manual/en/scripting/\r\n * Learn more about CCClass: https://docs.cocos.com/creator/3.3/manual/en/scripting/ccclass.html\r\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.3/manual/en/scripting/life-cycle-callbacks.html\r\n */\r\n"]}