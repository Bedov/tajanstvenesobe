{"version":3,"sources":["file:///Users/aleksandarbedov/Documents/CocosCreator/tajanstvenesobe2/assets/Scripts/SlideRotateCameraElevator.ts"],"names":["_decorator","Component","math","macro","systemEvent","SystemEvent","setDisplayStats","GameStatuType","GlobalManager","ccclass","property","Vec2","Vec3","Quat","v2_1","v2_2","v3_1","qt_1","KEYCODE","W","charCodeAt","S","A","D","Q","E","SHIFT","KEY","shift","SlideRotateCameraElevator","slide","range","onLoad","start","on","EventType","MOUSE_WHEEL","onMouseWheel","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","copy","_euler","node","eulerAngles","_position","position","onDestroy","off","update","dt","fromEuler","x","y","z","slerp","rotation","damp","setRotation","e","delta","getScrollY","moveSpeed","transformQuat","UNIT_Z","scaleAndAdd","_e","location","getLocation","even","getInstance","gameStatus","gamePaused","detectType","instance","canvas","getComponent","joystick_Mouse_Move","touches","getTouches","getStartLocation","getDelta","rotateSpeed","inverseCalculus","maxAngleDown","maxAngleUp","invertedRotation"],"mappings":"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","sourcesContent":["\nimport { _decorator,\n    Component,\n    math, \n    macro,\n    Label,\n    systemEvent,\n    SystemEvent,\n    game,\n    view,\n    setDisplayStats,\n    Node,\n    Game} from 'cc';\nconst { ccclass, property } = _decorator;\nconst { Vec2, Vec3, Quat } = math;\n\nconst v2_1 = new Vec2();\nconst v2_2 = new Vec2();\nconst v3_1 = new Vec3();\nconst qt_1 = new Quat();\nconst KEYCODE = {\n    W: 'W'.charCodeAt(0),\n    S: 'S'.charCodeAt(0),\n    A: 'A'.charCodeAt(0),\n    D: 'D'.charCodeAt(0),\n    Q: 'Q'.charCodeAt(0),\n    E: 'E'.charCodeAt(0),\n    SHIFT: macro.KEY.shift,\n}\n\nimport { DetectTypeOfDeviceElevator } from \"./DetectTypeOfDeviceElevator\";\nimport { GameManager, GameStatuType } from './GameManager';\nimport { GlobalManager } from './GlobalManager';\n\n@ccclass('SlideRotateCameraElevator')\nexport class SlideRotateCameraElevator extends Component {\n \n    @property\n    moveSpeed = 1.5;\n \n    @property\n    moveSpeedShiftScale = 5;\n \n    @property({ slide: true, range: [0.05, 0.5, 0.01] })\n    damp = 0.2;\n\n    @property\n    _eventOn = false;\n \n    @property\n    rotateSpeed = 1;\n    \n    @property\n    maxAngleUp = 70;\n    @property\n    maxAngleDown = 10;\n \n    _euler = new Vec3();\n    _velocity = new Vec3();\n    _position = new Vec3();\n    _speedScale = 1;\n\n    onLoad() {\n\n    }\n\n    start() {\n        systemEvent.on(SystemEvent.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\n        systemEvent.on(SystemEvent.EventType.TOUCH_START, this.onTouchStart, this);\n        systemEvent.on(SystemEvent.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        systemEvent.on(SystemEvent.EventType.TOUCH_END, this.onTouchEnd, this);\n        Vec3.copy(this._euler, this.node.eulerAngles);\n        Vec3.copy(this._position, this.node.position);\n\n        setDisplayStats(false); // 关闭左下角显示FPS\n    }\n \n    onDestroy() {\n        systemEvent.off(SystemEvent.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\n        systemEvent.off(SystemEvent.EventType.TOUCH_START, this.onTouchStart, this);\n        systemEvent.off(SystemEvent.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        systemEvent.off(SystemEvent.EventType.TOUCH_END, this.onTouchEnd, this);\n    }\n \n    update(dt: number) {\n        Quat.fromEuler(qt_1, this._euler.x, this._euler.y, this._euler.z);\n        Quat.slerp(qt_1, this.node.rotation, qt_1, dt / this.damp);\n   \n        this.node.setRotation(qt_1);\n    }\n\n    onMouseWheel(e: any) {\n        const delta = -e.getScrollY() * this.moveSpeed * 0.1; // delta is positive when scroll down\n        Vec3.transformQuat(v3_1, Vec3.UNIT_Z, this.node.rotation);\n        Vec3.scaleAndAdd(this._position, this.node.position, v3_1, delta);\n    }\n \n    onTouchStart(_e: any) {\n        \n        //if ((game.canvas as HTMLCanvasElement).requestPointerLock)\n        //    (game.canvas as HTMLCanvasElement).requestPointerLock();\n \n        let location = _e.getLocation();// 获取节点坐标\n    }\n\n    onTouchMove (e: any, even: any) {\n        if(GlobalManager.getInstance().gameStatus == GameStatuType.gamePaused ) {\n            return;\n        }\n        \n\n        var detectType = GlobalManager.instance.canvas!.getComponent(\"DetectTypeOfDeviceElevator\") as DetectTypeOfDeviceElevator;\n        detectType.joystick_Mouse_Move();\n \n        let touches = even.getTouches();\n \n            e.getStartLocation(v2_1);\n            \n            //if (v2_1.x > view.getFrameSize().width * 0.4) { // rotation\n                e.getDelta(v2_2);\n                this._euler.y -= v2_2.x * this.rotateSpeed * 0.1 * this.inverseCalculus();\n                this._euler.x += v2_2.y * this.rotateSpeed * 0.1 * this.inverseCalculus();\n                \n\n                if (this._euler.x <= -this.maxAngleDown) {\n                    this._euler.x = -this.maxAngleDown;\n                }\n                if (this._euler.x >= this.maxAngleUp) {\n                    this._euler.x = this.maxAngleUp;\n                }\n\n \n    }\n\n    inverseCalculus(){\n        if(GlobalManager.getInstance().invertedRotation) \n            return -1\n        else\n            return 1\n    }\n\n    onTouchEnd(e: any) {\n        //document.exitPointerLock();\n    }\n};"]}