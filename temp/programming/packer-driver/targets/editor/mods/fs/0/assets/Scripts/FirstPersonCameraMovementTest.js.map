{"version":3,"sources":["file:///Users/aleksandarbedov/Documents/CocosCreator/tajanstvenesobe2/assets/Scripts/FirstPersonCameraMovementTest.ts"],"names":["_decorator","Component","systemEvent","SystemEvent","Vec3","geometry","KeyCode","PhysicsSystem","RigidBody","find","GameManager","GameStatuType","GlobalManager","ccclass","property","KEYCODE","UP","ARROW_UP","DOWN","ARROW_DOWN","LEFT","ARROW_LEFT","RIGHT","ARROW_RIGHT","W","charCodeAt","S","A","D","Q","E","SPACE","SHIFT","SHIFT_LEFT","_pointerLockGeneral","_keyEvent","FirstPersonCameraMovementTest","slide","range","start","on","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","scaledSpeedCoeficient","getInstance","isMobileOrTablet","phoneCoeficient","copy","_position","node","position","onDestroy","off","jump","rigidBody","getComponent","hit","distance","currentVel3","getLinearVelocity","raycast","Ray","getWorldPosition","x","y","z","instance","r","raycastResults","item","shortestDistance","forEach","element","collider","name","hitPoint","setLinearVelocity","console","log","update","dt","gameStatus","gamePaused","runningSpeed","_keyPresed","creatingFinalVectorKeyboard","scaledVec3","_finalMoveVector","multiplyScalar","moveSpeed","multiplyQuatVec3","rotation","point","num1","num2","num3","num4","num5","num6","num7","num8","num9","num10","w","num11","num12","vector3","calculateForward","sila","vectorForward","FORWARD","calculateLeft","vectorLeft","negative","calculateRight","vectorRight","calculateBack","vectorBack","e","add","tutorialEnd","normalize","_tutorialEnded","detectType","keyboard_Move","creatingFinalVectorTouch","moveVec","temp","keyCode","sviPodignuti"],"mappings":"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","sourcesContent":["\nimport { _decorator,\n    Component,\n    math, \n    macro,\n    Label,\n    systemEvent,\n    SystemEvent,\n    game,\n    view,\n    Node,\n    Vec3,\n    Quat,\n    director,\n    geometry,\n    setDisplayStats,\n    sys,\n    EventKeyboard,\n    KeyCode,\n    PhysicsRayResult,\n    PhysicsSystem,\n    RigidBody,\n    Layers,\n    Scene,\n    find} from 'cc';\nconst { ccclass, property } = _decorator;\n//const outRay = new ray(0, -1, 0, 0, 1, 0);\n\nimport { DetectTypeOfDevice } from \"./DetectTypeOfDevice\";\nimport { GameManager, GameStatuType } from './GameManager';\nimport { GlobalManager } from './GlobalManager';\n\nconst KEYCODE = {\n    UP: KeyCode.ARROW_UP,\n    DOWN: KeyCode.ARROW_DOWN,\n    LEFT: KeyCode.ARROW_LEFT,\n    RIGHT: KeyCode.ARROW_RIGHT,\n    W: 'W'.charCodeAt(0),\n    S: 'S'.charCodeAt(0),\n    A: 'A'.charCodeAt(0),\n    D: 'D'.charCodeAt(0),\n    Q: 'Q'.charCodeAt(0),\n    E: 'E'.charCodeAt(0),\n    SPACE: KeyCode.SPACE,\n    SHIFT: KeyCode.SHIFT_LEFT,\n}\n\nvar _pointerLockGeneral = false;\nvar _keyEvent = [false];\n\n@ccclass('FirstPersonCameraMovementTest')\nexport class FirstPersonCameraMovementTest extends Component {\n\n    @property\n    moveSpeed = 1.5;\n\n    @property\n    forceStrenght = 1;\n \n \n    @property({ slide: true, range: [0.05, 0.5, 0.01] })\n    damp = 0.2;\n\n    _gotStartLocation = false;\n\n    @property\n    _eventOn = false;\n\n    _finalMoveVector = new Vec3;\n \n    _position = new Vec3();\n    _keyPresed = false;\n\n    _tutorialEnded = false;\n\n    _myGround! : Node ; \n    \n    @property\n    heightFromGround = 0.6;\n\n    _jumpTemp : number = 0;\n    _jumpHeight : number = .5;\n    _jumpSpeed : number = 2;\n    _jumpRise : boolean = true;\n    _jumpBool : boolean = false;\n\n    scaledSpeedCoeficient = 1;\n    phoneCoeficient: number = 1.3;\n\n    start() {\n        systemEvent.on(SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        systemEvent.on(SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n\n        this.scaledSpeedCoeficient = 1;//GameManager.getInstance().WorldRoot!.scale.x / 100 ;\n        //director.getPhysicsManager().enabled = true;\n\n        if(!GameManager.getInstance().isMobileOrTablet)\n            this.phoneCoeficient = 1;\n\n        Vec3.copy(this._position, this.node.position);\n    }\n \n    onDestroy() {\n        systemEvent.off(SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        systemEvent.off(SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    jump() {\n        var rigidBody = this.node.getComponent(RigidBody);\n\n        var hit: Vec3 = new Vec3();\n        var distance = 0; \n\n        var currentVel3 = new Vec3; \n        rigidBody?.getLinearVelocity(currentVel3);\n\n        var raycast: geometry.Ray = new geometry.Ray(this.node.getWorldPosition().x, this.node.getWorldPosition().y, this.node.getWorldPosition().z, 0, -1, 0);\n\n        if (PhysicsSystem.instance.raycast(raycast)) {\n            \n            const r = PhysicsSystem.instance.raycastResults;\n            var item = r[0];\n            var shortestDistance = 2;\n\n             r.forEach(element => {\n                if(element.collider.node.name != \"Player\" && (this.node.position.y - element.hitPoint.y) < shortestDistance) {\n                    item = element;\n                    shortestDistance = this.node.position.y - element.hitPoint.y;\n                }\n                \n            }); \n\n            if(item) {\n                if( (this.node.position.y - item.hitPoint.y ) < 1) {\n                    rigidBody?.setLinearVelocity(new Vec3( currentVel3.x, 5, currentVel3.z));\n                    console.log(\"Height \" + (this.node.position.y - item.hitPoint.y));\n                    console.log(\"Name \" + item.collider.node.name);\n                }    \n\n            }\n           \n        }\n        \n        \n\n    }\n \n    update(dt: number) {\n    \n        if(GameManager.getInstance().gameStatus == GameStatuType.gamePaused)\n            return;\n\n        \n\n        var runningSpeed = 0;\n        if(_keyEvent[KEYCODE.SHIFT] == true) \n            runningSpeed = 1;\n\n        //if(this._keyPresed && this.fpsMovement._pointerLockLocal ) \n        if(this._keyPresed ){\n            if(this.phoneCoeficient == 1)\n                this.creatingFinalVectorKeyboard();\n            //this.node.getComponent(RigidBody)?.applyImpulse(this._finalMoveVector.multiplyScalar(this.forceStrenght));\n            //this.node.getComponent(RigidBody)?.applyForce(this._finalMoveVector.multiplyScalar(this.forceStrenght));\n            var scaledVec3 = this._finalMoveVector.multiplyScalar( GlobalManager.getInstance().moveSpeed * this.moveSpeed * this.scaledSpeedCoeficient * this.phoneCoeficient  + runningSpeed);\n            var currentVel3 = new Vec3; \n            this.node.getComponent(RigidBody)?.getLinearVelocity(currentVel3);\n\n            this.node.getComponent(RigidBody)?.setLinearVelocity(new Vec3( scaledVec3.x, currentVel3.y , scaledVec3.z) );\n            \n            //this.node.position.add(this._finalMoveVector.multiplyScalar(this.moveSpeed) );\n        }     \n    }\n\n    multiplyQuatVec3(rotation: Quat, point: Vec3)\n    {\n      var num1: number = rotation.x * 2;\n      var num2: number  = rotation.y * 2;\n      var num3: number  = rotation.z * 2;\n      var num4: number  = rotation.x * num1;\n      var num5: number  = rotation.y * num2;\n      var num6: number  = rotation.z * num3;\n      var num7: number  = rotation.x * num2;\n      var num8: number  = rotation.x * num3;\n      var num9: number  = rotation.y * num3;\n      var num10: number  = rotation.w * num1;\n      var num11: number  = rotation.w * num2;\n      var num12: number  = rotation.w * num3;\n      var vector3: Vec3 = new Vec3;\n      vector3.x = ((1.0 - ( num5 +  num6)) *  point.x + ( num7 -  num12) *  point.y + ( num8 +  num11) *  point.z);\n      vector3.y = (( num7 +  num12) *  point.x + (1.0 - ( num4 +  num6)) *  point.y + ( num9 -  num10) *  point.z);\n      vector3.z = (( num8 -  num11) *  point.x + ( num9 +  num10) *  point.y + (1.0 - ( num4 +  num5)) *  point.z);\n      return vector3;\n    }\n\n\n    calculateForward(sila: number) {\n        var vectorForward = this.multiplyQuatVec3(this.node.rotation, Vec3.FORWARD);\n        vectorForward.y = 0;\n        \n        return vectorForward.multiplyScalar(sila);\n    }\n\n    calculateLeft(sila: number) {\n        var vectorLeft = this.multiplyQuatVec3(this.node.rotation, Vec3.RIGHT);\n\n        return vectorLeft.negative().multiplyScalar(sila);\n    }\n\n    calculateRight(sila: number) {\n        var vectorRight = this.multiplyQuatVec3(this.node.rotation, Vec3.RIGHT);\n\n        return vectorRight.multiplyScalar(sila);\n    }\n\n    calculateBack(sila: number) {\n        var vectorBack = this.multiplyQuatVec3(this.node.rotation, Vec3.FORWARD);\n        vectorBack.y = 0;\n\n        return vectorBack.negative().multiplyScalar(sila);\n    }\n\n    creatingFinalVectorKeyboard() {\n\n        var e = _keyEvent;\n        \n        if(_keyEvent[KEYCODE.UP] == true || _keyEvent[KEYCODE.W] == true ) {\n            this._finalMoveVector.add(this.calculateForward(1));\n            this.tutorialEnd();\n        }\n        if(_keyEvent[KEYCODE.LEFT] == true || _keyEvent[KEYCODE.A] == true ) {\n            this._finalMoveVector.add(this.calculateLeft(1));\n            this.tutorialEnd();\n        }\n        if(_keyEvent[KEYCODE.DOWN] == true || _keyEvent[KEYCODE.S] == true ) {\n            this._finalMoveVector.add(this.calculateBack(1));\n            this.tutorialEnd();\n        }\n        if(_keyEvent[KEYCODE.RIGHT] == true || _keyEvent[KEYCODE.D] == true ) {\n            this._finalMoveVector.add(this.calculateRight(1));\n            this.tutorialEnd();\n         }\n\n        this._finalMoveVector.normalize().multiplyScalar(GlobalManager.getInstance().moveSpeed );\n    }\n\n    tutorialEnd() {\n        if(this._tutorialEnded == false) {\n            var detectType =  find(\"Canvas\")!.getComponent(\"DetectTypeOfDevice\") as DetectTypeOfDevice;\n            detectType.keyboard_Move();\n\n            this._tutorialEnded = true;\n        }\n    }\n    \n\n    creatingFinalVectorTouch(moveVec: Vec3) {\n\n        var temp = new Vec3 (moveVec.x, 0, -moveVec.y);\n        this._finalMoveVector = this.multiplyQuatVec3(this.node.rotation,temp);\n        \n\n        this._finalMoveVector.multiplyScalar(GlobalManager.getInstance().moveSpeed * this.phoneCoeficient );\n        \n        if(moveVec.x != 0 || moveVec.y != 0)\n            this.tutorialEnd();\n\n    }\n\n    onKeyUp(e: any) {\n        _keyEvent[e.keyCode] = false;\n        this._finalMoveVector = new Vec3(0,0,0);\n\n        var sviPodignuti = true;\n        _keyEvent.forEach(element => {\n            if(element==true)\n                sviPodignuti = false;\n        });\n\n        if(sviPodignuti)\n            this._keyPresed = false;\n    }\n\n    onKeyDown(e: any) {\n        _keyEvent[e.keyCode] = true;\n        this._keyPresed = true;\n\n        if(_keyEvent[KEYCODE.SPACE] == true) \n            this.jump();\n    }   \n\n    \n\n};"]}