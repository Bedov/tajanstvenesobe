{"version":3,"sources":["file:///Users/aleksandarbedov/Documents/CocosCreator/tajanstvenesobe2/assets/Scripts/TouchInputElevator.ts"],"names":["_decorator","Component","Node","Vec2","SystemEvent","Vec3","UITransform","GameManager","GlobalManager","ccclass","property","TouchInputElevator","update","vec3ForMovement","Joystick_Ball","position","multiplyScalar","Joystick_Max","_firstPersonCameraMovement","creatingFinalVectorTouch","start","Player","getInstance","node","on","EventType","TOUCH_START","Joystick_Touch_Start","TOUCH_MOVE","Joystick_Touch_Move","TOUCH_END","Joystick_Touch_End","TOUCH_CANCEL","getComponent","_JoystickSize","width","onDestroy","off","event","_keyPresed","touch_pos","getUIStartLocation","x","y","local_touch_pos","convertToNodeSpaceAR","Limit_joystick_Vector","Set_Joystick_Ball_Position","Joystick_Vector","detectType","instance","canvas","joystick_Mouse_Move","getUILocation","ZERO","pos","setPosition","joystick_vector","input_mag","length"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Vec2, SystemEvent, Vec3, UITransform, Touch, Canvas, game, Game } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * Predefined variables\r\n * Name = TouchInput\r\n * DateTime = Mon Nov 15 2021 18:58:12 GMT+0100 (Central European Standard Time)\r\n * Author = stickandrope\r\n * FileBasename = TouchInput.ts\r\n * FileBasenameNoExtension = TouchInput\r\n * URL = db://assets/Scripts/TouchInput.ts\r\n * ManualUrl = https://docs.cocos.com/creator/3.3/manual/en/\r\n *\r\n */\r\n import { FirstPersonCameraMovement } from \"./FirstPersonCameraMovement\"; \r\n import { DetectTypeOfDevice } from \"./DetectTypeOfDevice\"; \r\nimport { GameManager } from './GameManager';\r\nimport { Task } from './Tasks/Task';\r\nimport { TaskManager } from './Tasks/TaskManager';\r\nimport { FirstPersonCameraMovementElevator } from './FirstPersonCameraMovementElevator';\r\nimport { DetectTypeOfDeviceElevator } from './DetectTypeOfDeviceElevator';\r\nimport { GlobalManager } from './GlobalManager';\r\n\r\n@ccclass('TouchInputElevator')\r\nexport class TouchInputElevator extends Component {\r\n\r\n    Player?: Node;\r\n\r\n    @property(Node)\r\n    Joystick_Ball!: Node;\r\n\r\n    @property(Vec3)\r\n    Joystick_Vector!: Vec3;\r\n\r\n    @property\r\n    Joystick_Max = 1;\r\n\r\n    _JoystickSize = 0;\r\n    _firstPersonCameraMovement!: FirstPersonCameraMovementElevator;\r\n\r\n    update() {\r\n\r\n        let vec3ForMovement = new Vec3(this.Joystick_Ball.position);//new Vec3( this.Joystick_Ball.position.);\r\n        vec3ForMovement.multiplyScalar(1 / this.Joystick_Max);\r\n        this._firstPersonCameraMovement.creatingFinalVectorTouch( vec3ForMovement );\r\n        \r\n        \r\n        //this.Joystick_Ball.position.x\r\n    }\r\n\r\n    start () {\r\n        this.Player = GameManager.getInstance().Player!;\r\n\r\n        this.node.on(SystemEvent.EventType.TOUCH_START, this.Joystick_Touch_Start, this);\r\n        this.node.on(SystemEvent.EventType.TOUCH_MOVE, this.Joystick_Touch_Move, this);\r\n        this.node.on(SystemEvent.EventType.TOUCH_END, this.Joystick_Touch_End, this);\r\n        this.node.on(SystemEvent.EventType.TOUCH_CANCEL, this.Joystick_Touch_End, this);\r\n//GameManager.instance\r\n        this._firstPersonCameraMovement = this.Player!.getComponent(\"FirstPersonCameraMovementElevator\") as FirstPersonCameraMovementElevator;\r\n\r\n        if(this.getComponent(UITransform) != null)\r\n            this._JoystickSize = this.getComponent(UITransform)!.width;\r\n    }\r\n\r\n\r\n    onDestroy() {\r\n        this.node.off(SystemEvent.EventType.TOUCH_START, this.Joystick_Touch_Start, this);\r\n        this.node.off(SystemEvent.EventType.TOUCH_MOVE, this.Joystick_Touch_Move, this);\r\n        this.node.off(SystemEvent.EventType.TOUCH_END, this.Joystick_Touch_End, this);\r\n        this.node.off(SystemEvent.EventType.TOUCH_CANCEL, this.Joystick_Touch_End, this);\r\n    }\r\n\r\n    Joystick_Touch_Start(event: Touch){\r\n        this._firstPersonCameraMovement._keyPresed = true;\r\n\r\n        let touch_pos = new Vec3 (event.getUIStartLocation().x, event.getUIStartLocation().y, 0) ; \r\n        \r\n        let local_touch_pos = this.node.getComponent(UITransform)!.convertToNodeSpaceAR(touch_pos) ;   \r\n\r\n        this.Limit_joystick_Vector(local_touch_pos);\r\n        this.Set_Joystick_Ball_Position(local_touch_pos);\r\n        this.Joystick_Vector = local_touch_pos;\r\n\r\n    }\r\n\r\n    Joystick_Touch_Move(event: Touch){\r\n        var detectType = GlobalManager.instance.canvas!.getComponent(\"DetectTypeOfDeviceElevator\") as DetectTypeOfDeviceElevator;\r\n        detectType.joystick_Mouse_Move();\r\n\r\n        \r\n        //Treba mozda pokriti dva prsta\r\n        let touch_pos = new Vec3 (event.getUILocation().x, event.getUILocation().y, 0) ; \r\n\r\n        let local_touch_pos = this.node.getComponent(UITransform)!.convertToNodeSpaceAR(touch_pos) ;   \r\n        this.Limit_joystick_Vector(local_touch_pos);\r\n        this.Set_Joystick_Ball_Position(local_touch_pos);\r\n        this.Joystick_Vector = local_touch_pos;\r\n\r\n\r\n\r\n    }\r\n\r\n    Joystick_Touch_End(){\r\n        this._firstPersonCameraMovement._keyPresed = false;\r\n\r\n        this.Joystick_Vector = new Vec3(Vec2.ZERO.x, Vec2.ZERO.y, 0);\r\n        this.Set_Joystick_Ball_Position( new Vec3(Vec2.ZERO.x, Vec2.ZERO.y, 0) );\r\n    }\r\n\r\n    Set_Joystick_Ball_Position(pos: Vec3){\r\n        \r\n        //console.log(\"SetJoystick \" + pos);\r\n        \r\n        this.Joystick_Ball.setPosition(pos);\r\n    }\r\n\r\n    Limit_joystick_Vector(joystick_vector: Vec3){\r\n\r\n        let input_mag = joystick_vector.length();\r\n        if(input_mag > this.Joystick_Max){\r\n            joystick_vector.multiplyScalar(this.Joystick_Max/input_mag);//  mulSelf();\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * [1] Class member could be defined like this.\r\n * [2] Use `property` decorator if your want the member to be serializable.\r\n * [3] Your initialization goes here.\r\n * [4] Your update function goes here.\r\n *\r\n * Learn more about scripting: https://docs.cocos.com/creator/3.3/manual/en/scripting/\r\n * Learn more about CCClass: https://docs.cocos.com/creator/3.3/manual/en/scripting/ccclass.html\r\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.3/manual/en/scripting/life-cycle-callbacks.html\r\n */\r\n"]}