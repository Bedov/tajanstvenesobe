{"version":3,"sources":["file:///Users/aleksandarbedov/Documents/CocosCreator/tajanstvenesobe2/assets/Scripts/FirstPersonCameraMovement.ts"],"names":["_decorator","Component","systemEvent","SystemEvent","Vec3","geometry","KeyCode","PhysicsSystem","RigidBody","GameManager","GameStatuType","ccclass","property","KEYCODE","UP","ARROW_UP","DOWN","ARROW_DOWN","LEFT","ARROW_LEFT","RIGHT","ARROW_RIGHT","W","charCodeAt","S","A","D","Q","E","SPACE","SHIFT","SHIFT_LEFT","_pointerLockGeneral","_keyEvent","FirstPersonCameraMovement","slide","range","start","on","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","scaledSpeedCoeficient","copy","_position","node","position","onDestroy","off","jump","_jumpBool","_jumpRise","update","dt","getInstance","gameStatus","gamePaused","raycast","Ray","x","y","z","raycast2","raycast3","hit","distance","_jumpTemp","_jumpSpeed","_jumpHeight","instance","r","raycastResults","visina","i","length","item","undefined","collider","name","hitPoint","heightFromGround","error","computeHit","runningSpeed","_keyPresed","creatingFinalVectorKeyboard","getComponent","setLinearVelocity","_finalMoveVector","multiplyScalar","moveSpeed","multiplyQuatVec3","rotation","point","num1","num2","num3","num4","num5","num6","num7","num8","num9","num10","w","num11","num12","vector3","calculateForward","sila","vectorForward","FORWARD","calculateLeft","vectorLeft","negative","calculateRight","vectorRight","calculateBack","vectorBack","e","add","tutorialEnd","normalize","_tutorialEnded","detectType","Canvas","keyboard_Move","creatingFinalVectorTouch","moveVec","temp","keyCode","sviPodignuti","forEach","element"],"mappings":"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","sourcesContent":["\nimport { _decorator,\n    Component,\n    math, \n    macro,\n    Label,\n    systemEvent,\n    SystemEvent,\n    game,\n    view,\n    Node,\n    Vec3,\n    Quat,\n    director,\n    geometry,\n    setDisplayStats,\n    sys,\n    EventKeyboard,\n    KeyCode,\n    PhysicsRayResult,\n    PhysicsSystem,\n    RigidBody,\n    Layers} from 'cc';\nconst { ccclass, property } = _decorator;\n//const outRay = new ray(0, -1, 0, 0, 1, 0);\n\nimport { DetectTypeOfDevice } from \"./DetectTypeOfDevice\";\nimport { GameManager, GameStatuType } from './GameManager';\n\nconst KEYCODE = {\n    UP: KeyCode.ARROW_UP,\n    DOWN: KeyCode.ARROW_DOWN,\n    LEFT: KeyCode.ARROW_LEFT,\n    RIGHT: KeyCode.ARROW_RIGHT,\n    W: 'W'.charCodeAt(0),\n    S: 'S'.charCodeAt(0),\n    A: 'A'.charCodeAt(0),\n    D: 'D'.charCodeAt(0),\n    Q: 'Q'.charCodeAt(0),\n    E: 'E'.charCodeAt(0),\n    SPACE: KeyCode.SPACE,\n    SHIFT: KeyCode.SHIFT_LEFT,\n}\n\nvar _pointerLockGeneral = false;\nvar _keyEvent = [false];\n\n@ccclass('FirstPersonCameraMovement')\nexport class FirstPersonCameraMovement extends Component {\n\n    @property\n    moveSpeed = 1;\n\n    @property\n    forceStrenght = 1;\n \n \n    @property({ slide: true, range: [0.05, 0.5, 0.01] })\n    damp = 0.2;\n\n    _gotStartLocation = false;\n\n    @property\n    _eventOn = false;\n\n    _finalMoveVector = new Vec3;\n \n    _position = new Vec3();\n    _keyPresed = false;\n\n    _tutorialEnded = false;\n\n    _myGround! : Node ; \n    \n    @property\n    heightFromGround = 0.6;\n\n    _jumpTemp : number = 0;\n    _jumpHeight : number = .5;\n    _jumpSpeed : number = 2;\n    _jumpRise : boolean = true;\n    _jumpBool : boolean = false;\n\n    scaledSpeedCoeficient = 1;\n\n    start() {\n        systemEvent.on(SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        systemEvent.on(SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n\n        this.scaledSpeedCoeficient = 1;//GameManager.getInstance().WorldRoot!.scale.x / 100 ;\n        //director.getPhysicsManager().enabled = true;\n\n        Vec3.copy(this._position, this.node.position);\n    }\n \n    onDestroy() {\n        systemEvent.off(SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        systemEvent.off(SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    jump() {\n        if(!this._jumpBool) {\n            this._jumpBool = true;\n            this._jumpRise = true;\n        }\n    }\n \n    update(dt: number) {\n    \n        if(GameManager.getInstance().gameStatus == GameStatuType.gamePaused)\n            return;\n        \n        var raycast: geometry.Ray = new geometry.Ray(this.node.position.x, this.node.position.y, this.node.position.z, 0, -1, 0);\n        var raycast2: geometry.Ray = new geometry.Ray(this.node.position.x + 0.01, this.node.position.y, this.node.position.z+ 0.01, 0, -1, 0);\n        var raycast3: geometry.Ray = new geometry.Ray(this.node.position.x- 0.01, this.node.position.y, this.node.position.z- 0.01, 0, -1, 0);\n\n        var hit: Vec3 = new Vec3();\n        var distance = 0; \n\n        \n\n\n        if(this._jumpBool) {\n            if(this._jumpRise) \n                this._jumpTemp += dt * this._jumpSpeed;\n            else\n                this._jumpTemp -= dt * this._jumpSpeed;\n\n            if(this._jumpTemp > this._jumpHeight && this._jumpRise)\n                this._jumpRise = false;\n           \n            if( this._jumpTemp <= 0 && !this._jumpRise )\n                {\n                    this._jumpBool = false;\n                }\n        }\n\n        if (PhysicsSystem.instance.raycast(raycast)) {\n            const r = PhysicsSystem.instance.raycastResults;\n\n            var visina = new Vec3(0,-200,0);\n\n            for (let i = 0; i < r.length; i++){\n\n                const item = r[i];\n\n                try {\n                    if( item != undefined && item != null) {\n                        if( item.collider.node.name == \"Ground002\") {\n                            if(visina.y < item.hitPoint.y + this.heightFromGround + this._jumpTemp )\n                                visina = new Vec3(item.hitPoint.x, item.hitPoint.y + this.heightFromGround + this._jumpTemp, item.hitPoint.z);\n                        }\n                    }\n                } catch (error) {\n                    \n                }\n            }\n            this.node.position = visina;\n\n        }\n\n        raycast.computeHit(hit, distance);\n\n        var runningSpeed = 0;\n        if(_keyEvent[KEYCODE.SHIFT] == true) \n            runningSpeed = 1;\n\n        //if(this._keyPresed && this.fpsMovement._pointerLockLocal ) \n        if(this._keyPresed ){\n            this.creatingFinalVectorKeyboard();\n            //this.node.getComponent(RigidBody)?.applyImpulse(this._finalMoveVector.multiplyScalar(this.forceStrenght));\n            //this.node.getComponent(RigidBody)?.applyForce(this._finalMoveVector.multiplyScalar(this.forceStrenght));\n            this.node.getComponent(RigidBody)?.setLinearVelocity(this._finalMoveVector.multiplyScalar( GameManager.getInstance().moveSpeed * this.scaledSpeedCoeficient + runningSpeed ))\n            \n            //this.node.position.add(this._finalMoveVector.multiplyScalar(this.moveSpeed) );\n        }     \n    }\n\n    multiplyQuatVec3(rotation: Quat, point: Vec3)\n    {\n      var num1: number = rotation.x * 2;\n      var num2: number  = rotation.y * 2;\n      var num3: number  = rotation.z * 2;\n      var num4: number  = rotation.x * num1;\n      var num5: number  = rotation.y * num2;\n      var num6: number  = rotation.z * num3;\n      var num7: number  = rotation.x * num2;\n      var num8: number  = rotation.x * num3;\n      var num9: number  = rotation.y * num3;\n      var num10: number  = rotation.w * num1;\n      var num11: number  = rotation.w * num2;\n      var num12: number  = rotation.w * num3;\n      var vector3: Vec3 = new Vec3;\n      vector3.x = ((1.0 - ( num5 +  num6)) *  point.x + ( num7 -  num12) *  point.y + ( num8 +  num11) *  point.z);\n      vector3.y = (( num7 +  num12) *  point.x + (1.0 - ( num4 +  num6)) *  point.y + ( num9 -  num10) *  point.z);\n      vector3.z = (( num8 -  num11) *  point.x + ( num9 +  num10) *  point.y + (1.0 - ( num4 +  num5)) *  point.z);\n      return vector3;\n    }\n\n\n    calculateForward(sila: number) {\n        var vectorForward = this.multiplyQuatVec3(this.node.rotation, Vec3.FORWARD);\n        vectorForward.y = 0;\n        \n        return vectorForward.multiplyScalar(sila);\n    }\n\n    calculateLeft(sila: number) {\n        var vectorLeft = this.multiplyQuatVec3(this.node.rotation, Vec3.RIGHT);\n\n        return vectorLeft.negative().multiplyScalar(sila);\n    }\n\n    calculateRight(sila: number) {\n        var vectorRight = this.multiplyQuatVec3(this.node.rotation, Vec3.RIGHT);\n\n        return vectorRight.multiplyScalar(sila);\n    }\n\n    calculateBack(sila: number) {\n        var vectorBack = this.multiplyQuatVec3(this.node.rotation, Vec3.FORWARD);\n        vectorBack.y = 0;\n\n        return vectorBack.negative().multiplyScalar(sila);\n    }\n\n    creatingFinalVectorKeyboard() {\n\n        var e = _keyEvent;\n        \n        if(_keyEvent[KEYCODE.UP] == true || _keyEvent[KEYCODE.W] == true ) {\n            this._finalMoveVector.add(this.calculateForward(1));\n            this.tutorialEnd();\n        }\n        if(_keyEvent[KEYCODE.LEFT] == true || _keyEvent[KEYCODE.A] == true ) {\n            this._finalMoveVector.add(this.calculateLeft(1));\n            this.tutorialEnd();\n        }\n        if(_keyEvent[KEYCODE.DOWN] == true || _keyEvent[KEYCODE.S] == true ) {\n            this._finalMoveVector.add(this.calculateBack(1));\n            this.tutorialEnd();\n        }\n        if(_keyEvent[KEYCODE.RIGHT] == true || _keyEvent[KEYCODE.D] == true ) {\n            this._finalMoveVector.add(this.calculateRight(1));\n            this.tutorialEnd();\n         }\n\n        this._finalMoveVector.normalize().multiplyScalar(GameManager.getInstance().moveSpeed);\n    }\n\n    tutorialEnd() {\n        if(this._tutorialEnded == false) {\n            var detectType = GameManager.instance.Canvas!.getComponent(\"DetectTypeOfDevice\") as DetectTypeOfDevice;\n            detectType.keyboard_Move();\n\n            this._tutorialEnded = true;\n        }\n    }\n    \n\n    creatingFinalVectorTouch(moveVec: Vec3) {\n\n        var temp = new Vec3 (moveVec.x, 0, -moveVec.y);\n        this._finalMoveVector = this.multiplyQuatVec3(this.node.rotation,temp);\n        \n\n        this._finalMoveVector.multiplyScalar(GameManager.getInstance().moveSpeed);\n        \n        if(moveVec.x != 0 || moveVec.y != 0)\n            this.tutorialEnd();\n\n    }\n\n    onKeyUp(e: any) {\n        _keyEvent[e.keyCode] = false;\n        this._finalMoveVector = new Vec3(0,0,0);\n\n        var sviPodignuti = true;\n        _keyEvent.forEach(element => {\n            if(element==true)\n                sviPodignuti = false;\n        });\n\n        if(sviPodignuti)\n            this._keyPresed = false;\n    }\n\n    onKeyDown(e: any) {\n        _keyEvent[e.keyCode] = true;\n        this._keyPresed = true;\n\n        if(_keyEvent[KEYCODE.SPACE] == true) \n            this.jump();\n    }   \n\n    \n\n};"]}