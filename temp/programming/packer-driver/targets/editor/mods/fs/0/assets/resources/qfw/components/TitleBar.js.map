{"version":3,"sources":["file:///Users/aleksandarbedov/Documents/CocosCreator/tajanstvenesobe2/assets/resources/qfw/components/TitleBar.ts"],"names":["_decorator","Component","LabelComponent","loader","Prefab","instantiate","v3","find","FollowCamera","ccclass","property","TitleBar","Date","now","start","_titleBarPoint","node","getChildByName","loadTitleBar","loadRes","err","asset","isValid","titleBar","root","addChild","_titleBar","_hpBar","_mpBar","_nameTxt","getComponent","setHPPercent","_hpPercent","setMPPercent","_mpPercent","setName","_nameStr","onDestroy","removeFromParent","update","deltaTime","_lastUpdateTime","getWorldPosition","_targetPos","inst","camera","convertToUINode","parent","position","percent","setScale","name","string"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, LabelComponent, loader, Prefab, instantiate, Vec3, v3, find } from 'cc';\nimport { UIMgr, UILayer } from '../qfw/UIMgr';\nimport { FollowCamera } from './FollowCamera';\nconst { ccclass, property } = _decorator;\n\n@ccclass('TitleBar')\nexport class TitleBar extends Component {\n\n    private _titleBar: Node = null;\n    private _hpBar: Node = null;\n    private _mpBar: Node = null;\n    private _nameTxt: LabelComponent = null;\n\n    private _hpPercent: number = 1;\n    private _mpPercent: number = 1;\n    private _nameStr: string = '不要太酷哦';\n\n    private _targetPos = v3();\n    private _offsetY: number = 1;\n\n    private _lastUpdateTime = Date.now();\n    private _titleBarPoint:Node = null;\n    start() {\n        this._titleBarPoint = this.node.getChildByName('title_bar_point') || this.node;\n        this.loadTitleBar();\n    }\n\n    loadTitleBar() {\n        loader.loadRes('title_bar', Prefab, (err, asset: Prefab) => {\n            if (!this.isValid || !this.node.isValid) {\n                return;\n            }\n            let titleBar = instantiate(asset);\n            let root = find('Canvas'); //UIMgr.inst.getLayerNode(UILayer.GAME);\n            root.addChild(titleBar);\n            this._titleBar = titleBar;\n            this._hpBar = titleBar.getChildByName('hp_bar');\n            this._mpBar = titleBar.getChildByName('mp_bar');\n            this._nameTxt = titleBar.getChildByName('name').getComponent(LabelComponent);\n\n            this.setHPPercent(this._hpPercent);\n            this.setMPPercent(this._mpPercent);\n            this.setName(this._nameStr);\n        });\n    }\n\n    onDestroy() {\n        if (this._titleBar) {\n            this._titleBar.removeFromParent();\n        }\n        this._titleBar = null;\n    }\n\n    //slow-update. fps = 10\n    update(deltaTime: number) {\n        if (!this._titleBar) {\n            return;\n        }\n\n        let now = Date.now();\n        if (now - this._lastUpdateTime < 100) {\n            return;\n        }\n\n        this._titleBarPoint.getWorldPosition(this._targetPos);\n        //this._targetPos.y += this._offsetY;\n        FollowCamera.inst.camera.convertToUINode(this._targetPos, this._titleBar.parent,this._targetPos);\n        this._titleBar.position = this._targetPos;\n    }\n\n    setHPPercent(percent: number) {\n        this._hpPercent = percent;\n        if (this._hpBar) {\n            this._hpBar.setScale(percent, 1, 1);\n        }\n    }\n\n    setMPPercent(percent: number) {\n        this._mpPercent = percent;\n        if (this._mpBar) {\n            this._mpBar.setScale(percent, 1, 1);\n        }\n    }\n\n    setName(name: string) {\n        this._nameStr = name;\n        if (this._nameTxt) {\n            this._nameTxt.string = this._nameStr;\n        }\n    }\n}\n"]}